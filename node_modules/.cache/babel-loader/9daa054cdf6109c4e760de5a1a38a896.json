{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { addClass, append, createElement, extend, remove } from '@syncfusion/ej2-base';\nimport { setStyleAttribute, EventHandler } from '@syncfusion/ej2-base';\nimport { TimelineEvent } from './timeline-view';\nimport * as util from '../base/util';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nvar EVENT_GAP = 2;\n/**\n * Year view events render\n */\n\nvar YearEvent =\n/** @class */\nfunction (_super) {\n  __extends(YearEvent, _super);\n  /**\n   * Constructor for year events\n   */\n\n\n  function YearEvent(parent) {\n    return _super.call(this, parent, 'day') || this;\n  }\n\n  YearEvent.prototype.renderAppointments = function () {\n    this.fields = this.parent.eventFields;\n    var eventWrapper = this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n    eventWrapper.forEach(function (node) {\n      return remove(node);\n    });\n    this.renderedEvents = [];\n\n    if (this.parent.currentView !== 'TimelineYear') {\n      this.yearViewEvents();\n    } else {\n      this.timelineYearViewEvents();\n    }\n\n    this.parent.notify(events.contentReady, {});\n  };\n\n  YearEvent.prototype.yearViewEvents = function () {\n    for (var month = 0; month < 12; month++) {\n      var queryString = \".e-month-calendar:nth-child(\" + (month + 1) + \") td.e-work-cells\";\n      var workCells = [].slice.call(this.parent.element.querySelectorAll(queryString));\n      var monthDate = new Date(this.parent.selectedDate.getFullYear(), month, this.parent.selectedDate.getDate());\n      var monthStart = this.parent.calendarUtil.getMonthStartDate(new Date(monthDate.getTime()));\n      var monthEnd = this.parent.calendarUtil.getMonthEndDate(new Date(monthDate.getTime()));\n      var startDate = util.getWeekFirstDate(monthStart, this.parent.firstDayOfWeek);\n      var endDate = util.addDays(util.getWeekLastDate(monthEnd, this.parent.firstDayOfWeek), 1);\n\n      for (var index = 0; startDate.getTime() < endDate.getTime(); index++) {\n        var start = util.resetTime(new Date(startDate.getTime()));\n        var end = util.addDays(new Date(start.getTime()), 1);\n        var filterEvents = this.parent.eventBase.filterEvents(start, end);\n\n        if (filterEvents.length > 0) {\n          var workCell = workCells[index];\n\n          if (workCell) {\n            workCell.appendChild(createElement('div', {\n              className: cls.APPOINTMENT_CLASS\n            }));\n          }\n        }\n\n        startDate = util.addDays(new Date(startDate.getTime()), 1);\n      }\n    }\n  };\n\n  YearEvent.prototype.timelineYearViewEvents = function () {\n    var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n    this.cellWidth = workCell.offsetWidth;\n    this.cellHeight = workCell.offsetHeight;\n    this.cellHeader = workCell.querySelector('.' + cls.DATE_HEADER_CLASS).offsetHeight;\n    var eventTable = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n    this.eventHeight = util.getElementHeightFromClass(eventTable, cls.APPOINTMENT_CLASS);\n    var wrapperCollection = this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n\n    for (var row = 0; row < 12; row++) {\n      var wrapper = wrapperCollection.item(row);\n      var eventWrapper = createElement('div', {\n        className: cls.APPOINTMENT_WRAPPER_CLASS\n      });\n      wrapper.appendChild(eventWrapper);\n      var monthStart = new Date(this.parent.selectedDate.getFullYear(), row, 1);\n      var monthEnd = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 0);\n      var dayIndex = monthStart.getDay();\n\n      while (monthStart.getTime() <= monthEnd.getTime()) {\n        var leftValue = void 0;\n\n        if (this.parent.activeViewOptions.orientation === 'Vertical') {\n          var wrapper_1 = wrapperCollection.item(dayIndex);\n          var eventWrapper_1 = wrapper_1.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n\n          if (!eventWrapper_1) {\n            eventWrapper_1 = createElement('div', {\n              className: cls.APPOINTMENT_WRAPPER_CLASS\n            });\n            wrapper_1.appendChild(eventWrapper_1);\n          }\n\n          leftValue = row * this.cellWidth;\n        } else {\n          leftValue = (dayIndex + monthStart.getDate() - 1) * this.cellWidth;\n        }\n\n        var dayStart = util.resetTime(new Date(monthStart.getTime()));\n        var dayEnd = util.addDays(new Date(dayStart.getTime()), 1);\n        var dayEvents = this.parent.eventBase.filterEvents(dayStart, dayEnd);\n\n        var _loop_1 = function (index, count) {\n          var eventData = extend({}, dayEvents[index], null, true);\n          var overlapIndex = this_1.getIndex(eventData[this_1.fields.startTime]);\n          eventData.Index = overlapIndex;\n          var availedHeight = this_1.cellHeader + this_1.eventHeight * (index + 1) + EVENT_GAP + this_1.moreIndicatorHeight;\n\n          if (this_1.parent.activeViewOptions.orientation === 'Horizontal') {\n            var isRendered = this_1.renderedEvents.filter(function (eventObj) {\n              return eventObj.Guid === eventData.Guid;\n            });\n\n            if (isRendered.length > 0) {\n              return \"continue\";\n            }\n          }\n\n          if (this_1.cellHeight > availedHeight) {\n            this_1.renderEvent(eventWrapper, eventData, row, leftValue, overlapIndex, dayIndex);\n          } else {\n            var moreIndex = this_1.parent.activeViewOptions.orientation === 'Horizontal' ? row : dayIndex;\n            this_1.renderMoreIndicatior(eventWrapper, count - index, dayStart, moreIndex, leftValue, dayEvents);\n\n            if (this_1.parent.activeViewOptions.orientation === 'Horizontal') {\n              for (var a = index; a < dayEvents.length; a++) {\n                var moreData = extend({}, dayEvents[a], {\n                  Index: overlapIndex + a\n                }, true);\n                this_1.renderedEvents.push(moreData);\n              }\n            }\n\n            return \"break\";\n          }\n        };\n\n        var this_1 = this;\n\n        for (var index = 0, count = dayEvents.length; index < count; index++) {\n          var state_1 = _loop_1(index, count);\n\n          if (state_1 === \"break\") break;\n        }\n\n        monthStart = util.addDays(new Date(monthStart.getTime()), 1);\n\n        if (this.parent.activeViewOptions.orientation === 'Vertical') {\n          dayIndex++;\n          this.renderedEvents = [];\n        }\n      }\n    }\n  };\n\n  YearEvent.prototype.renderEvent = function (wrapper, eventData, row, left, overlapCount, rowIndex) {\n    var _this = this;\n\n    var eventObj = this.isSpannedEvent(eventData, row);\n    var wrap = this.createEventElement(eventObj);\n    var width;\n    var top;\n\n    if (this.parent.activeViewOptions.orientation === 'Horizontal') {\n      width = eventObj.isSpanned.count * this.cellWidth;\n      top = this.cellHeader + this.eventHeight * overlapCount + EVENT_GAP + this.cellHeight * row;\n    } else {\n      width = this.cellWidth;\n      top = this.cellHeight * rowIndex + this.cellHeader + this.eventHeight * overlapCount + EVENT_GAP;\n    }\n\n    setStyleAttribute(wrap, {\n      'width': width + 'px',\n      'height': this.eventHeight + 'px',\n      'left': left + 'px',\n      'top': top + 'px'\n    });\n    var args = {\n      data: eventObj,\n      element: wrap,\n      cancel: false,\n      type: 'event'\n    };\n    this.parent.trigger(events.eventRendered, args, function (eventArgs) {\n      if (!eventArgs.cancel) {\n        wrapper.appendChild(wrap);\n\n        _this.wireAppointmentEvents(wrap, eventObj, true);\n\n        _this.renderedEvents.push(extend({}, eventObj, null, true));\n      }\n    });\n  };\n\n  YearEvent.prototype.renderMoreIndicatior = function (wrapper, count, startDate, row, left, events) {\n    var endDate = util.addDays(new Date(startDate.getTime()), 1);\n    var moreIndicator = this.getMoreIndicatorElement(count, startDate, endDate);\n    var rowTr = this.parent.element.querySelector(\".e-content-wrap tr:nth-child(\" + (row + 1) + \")\");\n    var top = rowTr.offsetTop + (this.cellHeight - this.moreIndicatorHeight);\n    left = Math.floor(left / this.cellWidth) * this.cellWidth;\n    setStyleAttribute(moreIndicator, {\n      'width': this.cellWidth + 'px',\n      'left': left + 'px',\n      'top': top + 'px'\n    });\n    wrapper.appendChild(moreIndicator);\n    EventHandler.add(moreIndicator, 'click', this.moreIndicatorClick, this);\n  };\n\n  YearEvent.prototype.createEventElement = function (record) {\n    var eventSubject = record[this.fields.subject] || this.parent.eventSettings.fields.subject.default;\n    var eventWrapper = createElement('div', {\n      className: cls.APPOINTMENT_CLASS,\n      attrs: {\n        'data-id': 'Appointment_' + record[this.fields.id],\n        'data-guid': record.Guid,\n        'role': 'button',\n        'tabindex': '0',\n        'aria-readonly': this.parent.eventBase.getReadonlyAttribute(record),\n        'aria-selected': 'false',\n        'aria-grabbed': 'true'\n      }\n    });\n\n    if (this.cssClass) {\n      addClass([eventWrapper], this.cssClass);\n    }\n\n    if (record[this.fields.isReadonly]) {\n      addClass([eventWrapper], cls.READ_ONLY);\n    }\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      var resIndex = this.getGroupIndexFromEvent(record);\n      eventWrapper.setAttribute('data-group-index', resIndex.toString());\n    }\n\n    var templateElement = [];\n    var eventObj = extend({}, record, null, true);\n\n    if (this.parent.activeViewOptions.eventTemplate) {\n      var templateId = this.parent.element.id + '_' + this.parent.activeViewOptions.eventTemplateName + 'eventTemplate';\n      var templateArgs = util.addLocalOffsetToEvent(eventObj, this.parent.eventFields);\n      templateElement = this.parent.getAppointmentTemplate()(templateArgs, this.parent, 'eventTemplate', templateId, false);\n    } else {\n      var locationEle = record[this.fields.location] || this.parent.eventSettings.fields.location.default || '';\n      var subjectEle = createElement('div', {\n        className: cls.SUBJECT_CLASS,\n        innerHTML: eventSubject + (locationEle ? ';&nbsp' + locationEle : '')\n      });\n      var startTimeEle = createElement('div', {\n        className: cls.APPOINTMENT_TIME + (this.parent.isAdaptive ? ' ' + cls.DISABLE_CLASS : ''),\n        innerHTML: this.parent.getTimeString(eventObj[this.fields.startTime])\n      });\n      var endTimeEle = createElement('div', {\n        className: cls.APPOINTMENT_TIME + (this.parent.isAdaptive ? ' ' + cls.DISABLE_CLASS : ''),\n        innerHTML: this.parent.getTimeString(eventObj[this.fields.endTime])\n      });\n      addClass([subjectEle], 'e-text-center');\n\n      if (record[this.fields.isAllDay]) {\n        templateElement = [subjectEle];\n      } else if (!eventObj.isLeft && !eventObj.isRight) {\n        templateElement = [startTimeEle, subjectEle, endTimeEle];\n      } else {\n        if (!eventObj.isLeft) {\n          templateElement.push(startTimeEle);\n        }\n\n        templateElement.push(subjectEle);\n\n        if (!eventObj.isRight) {\n          templateElement.push(endTimeEle);\n        }\n      }\n    }\n\n    var appointmentDetails = createElement('div', {\n      className: cls.APPOINTMENT_DETAILS\n    });\n    append(templateElement, appointmentDetails);\n    eventWrapper.appendChild(appointmentDetails);\n    this.applyResourceColor(eventWrapper, eventObj, 'backgroundColor', this.groupOrder);\n    return eventWrapper;\n  };\n\n  YearEvent.prototype.isSpannedEvent = function (eventObj, month) {\n    var monthStart = new Date(this.parent.selectedDate.getFullYear(), month, 1);\n    var monthEnd = util.addDays(new Date(this.parent.selectedDate.getFullYear(), month + 1, 0), 1);\n    var eventData = extend({}, eventObj, null, true);\n    var eventStart = eventData[this.fields.startTime];\n    var eventEnd = eventData[this.fields.endTime];\n    eventData.isSpanned = {\n      count: Math.ceil((eventEnd.getTime() - eventStart.getTime()) / util.MS_PER_DAY),\n      isLeft: eventStart.getTime() < monthStart.getTime(),\n      isRight: eventEnd.getTime() > monthEnd.getTime()\n    };\n    return eventData;\n  };\n\n  YearEvent.prototype.getOverlapEvents = function (date, appointments) {\n    var appointmentsList = [];\n\n    for (var _i = 0, _a = appointments; _i < _a.length; _i++) {\n      var app = _a[_i];\n      var appStart = new Date(app[this.fields.startTime].getTime());\n      var appEnd = new Date(app[this.fields.endTime].getTime());\n\n      if (util.resetTime(appStart).getTime() <= util.resetTime(new Date(date.getTime())).getTime() && util.resetTime(appEnd).getTime() >= util.resetTime(new Date(date.getTime())).getTime()) {\n        appointmentsList.push(app);\n      }\n    }\n\n    return appointmentsList;\n  };\n\n  return YearEvent;\n}(TimelineEvent);\n\nexport { YearEvent };","map":{"version":3,"sources":["C:/Users/grigo/OneDrive/Рабочий стол/CRM/node_modules/@syncfusion/ej2-schedule/src/schedule/event-renderer/year.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","addClass","append","createElement","extend","remove","setStyleAttribute","EventHandler","TimelineEvent","util","events","cls","EVENT_GAP","YearEvent","_super","parent","call","renderAppointments","fields","eventFields","eventWrapper","element","querySelectorAll","APPOINTMENT_WRAPPER_CLASS","forEach","node","renderedEvents","currentView","yearViewEvents","timelineYearViewEvents","notify","contentReady","month","queryString","workCells","slice","monthDate","Date","selectedDate","getFullYear","getDate","monthStart","calendarUtil","getMonthStartDate","getTime","monthEnd","getMonthEndDate","startDate","getWeekFirstDate","firstDayOfWeek","endDate","addDays","getWeekLastDate","index","start","resetTime","end","filterEvents","eventBase","length","workCell","appendChild","className","APPOINTMENT_CLASS","querySelector","WORK_CELLS_CLASS","cellWidth","offsetWidth","cellHeight","offsetHeight","cellHeader","DATE_HEADER_CLASS","eventTable","EVENT_TABLE_CLASS","eventHeight","getElementHeightFromClass","wrapperCollection","APPOINTMENT_CONTAINER_CLASS","row","wrapper","item","getMonth","dayIndex","getDay","leftValue","activeViewOptions","orientation","wrapper_1","eventWrapper_1","dayStart","dayEnd","dayEvents","_loop_1","count","eventData","overlapIndex","this_1","getIndex","startTime","Index","availedHeight","moreIndicatorHeight","isRendered","filter","eventObj","Guid","renderEvent","moreIndex","renderMoreIndicatior","a","moreData","push","state_1","left","overlapCount","rowIndex","_this","isSpannedEvent","wrap","createEventElement","width","top","isSpanned","args","data","cancel","type","trigger","eventRendered","eventArgs","wireAppointmentEvents","moreIndicator","getMoreIndicatorElement","rowTr","offsetTop","Math","floor","add","moreIndicatorClick","record","eventSubject","subject","eventSettings","default","attrs","id","getReadonlyAttribute","cssClass","isReadonly","READ_ONLY","group","resources","resIndex","getGroupIndexFromEvent","setAttribute","toString","templateElement","eventTemplate","templateId","eventTemplateName","templateArgs","addLocalOffsetToEvent","getAppointmentTemplate","locationEle","location","subjectEle","SUBJECT_CLASS","innerHTML","startTimeEle","APPOINTMENT_TIME","isAdaptive","DISABLE_CLASS","getTimeString","endTimeEle","endTime","isAllDay","isLeft","isRight","appointmentDetails","APPOINTMENT_DETAILS","applyResourceColor","groupOrder","eventStart","eventEnd","ceil","MS_PER_DAY","getOverlapEvents","date","appointments","appointmentsList","_i","_a","app","appStart","appEnd"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { addClass, append, createElement, extend, remove } from '@syncfusion/ej2-base';\nimport { setStyleAttribute, EventHandler } from '@syncfusion/ej2-base';\nimport { TimelineEvent } from './timeline-view';\nimport * as util from '../base/util';\nimport * as events from '../base/constant';\nimport * as cls from '../base/css-constant';\nvar EVENT_GAP = 2;\n/**\n * Year view events render\n */\nvar YearEvent = /** @class */ (function (_super) {\n    __extends(YearEvent, _super);\n    /**\n     * Constructor for year events\n     */\n    function YearEvent(parent) {\n        return _super.call(this, parent, 'day') || this;\n    }\n    YearEvent.prototype.renderAppointments = function () {\n        this.fields = this.parent.eventFields;\n        var eventWrapper = this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n        eventWrapper.forEach(function (node) { return remove(node); });\n        this.renderedEvents = [];\n        if (this.parent.currentView !== 'TimelineYear') {\n            this.yearViewEvents();\n        }\n        else {\n            this.timelineYearViewEvents();\n        }\n        this.parent.notify(events.contentReady, {});\n    };\n    YearEvent.prototype.yearViewEvents = function () {\n        for (var month = 0; month < 12; month++) {\n            var queryString = \".e-month-calendar:nth-child(\" + (month + 1) + \") td.e-work-cells\";\n            var workCells = [].slice.call(this.parent.element.querySelectorAll(queryString));\n            var monthDate = new Date(this.parent.selectedDate.getFullYear(), month, this.parent.selectedDate.getDate());\n            var monthStart = this.parent.calendarUtil.getMonthStartDate(new Date(monthDate.getTime()));\n            var monthEnd = this.parent.calendarUtil.getMonthEndDate(new Date(monthDate.getTime()));\n            var startDate = util.getWeekFirstDate(monthStart, this.parent.firstDayOfWeek);\n            var endDate = util.addDays(util.getWeekLastDate(monthEnd, this.parent.firstDayOfWeek), 1);\n            for (var index = 0; startDate.getTime() < endDate.getTime(); index++) {\n                var start = util.resetTime(new Date(startDate.getTime()));\n                var end = util.addDays(new Date(start.getTime()), 1);\n                var filterEvents = this.parent.eventBase.filterEvents(start, end);\n                if (filterEvents.length > 0) {\n                    var workCell = workCells[index];\n                    if (workCell) {\n                        workCell.appendChild(createElement('div', { className: cls.APPOINTMENT_CLASS }));\n                    }\n                }\n                startDate = util.addDays(new Date(startDate.getTime()), 1);\n            }\n        }\n    };\n    YearEvent.prototype.timelineYearViewEvents = function () {\n        var workCell = this.parent.element.querySelector('.' + cls.WORK_CELLS_CLASS);\n        this.cellWidth = workCell.offsetWidth;\n        this.cellHeight = workCell.offsetHeight;\n        this.cellHeader = workCell.querySelector('.' + cls.DATE_HEADER_CLASS).offsetHeight;\n        var eventTable = this.parent.element.querySelector('.' + cls.EVENT_TABLE_CLASS);\n        this.eventHeight = util.getElementHeightFromClass(eventTable, cls.APPOINTMENT_CLASS);\n        var wrapperCollection = this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CONTAINER_CLASS);\n        for (var row = 0; row < 12; row++) {\n            var wrapper = wrapperCollection.item(row);\n            var eventWrapper = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n            wrapper.appendChild(eventWrapper);\n            var monthStart = new Date(this.parent.selectedDate.getFullYear(), row, 1);\n            var monthEnd = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 0);\n            var dayIndex = monthStart.getDay();\n            while (monthStart.getTime() <= monthEnd.getTime()) {\n                var leftValue = void 0;\n                if (this.parent.activeViewOptions.orientation === 'Vertical') {\n                    var wrapper_1 = wrapperCollection.item(dayIndex);\n                    var eventWrapper_1 = wrapper_1.querySelector('.' + cls.APPOINTMENT_WRAPPER_CLASS);\n                    if (!eventWrapper_1) {\n                        eventWrapper_1 = createElement('div', { className: cls.APPOINTMENT_WRAPPER_CLASS });\n                        wrapper_1.appendChild(eventWrapper_1);\n                    }\n                    leftValue = row * this.cellWidth;\n                }\n                else {\n                    leftValue = ((dayIndex + monthStart.getDate()) - 1) * this.cellWidth;\n                }\n                var dayStart = util.resetTime(new Date(monthStart.getTime()));\n                var dayEnd = util.addDays(new Date(dayStart.getTime()), 1);\n                var dayEvents = this.parent.eventBase.filterEvents(dayStart, dayEnd);\n                var _loop_1 = function (index, count) {\n                    var eventData = extend({}, dayEvents[index], null, true);\n                    var overlapIndex = this_1.getIndex(eventData[this_1.fields.startTime]);\n                    eventData.Index = overlapIndex;\n                    var availedHeight = this_1.cellHeader + (this_1.eventHeight * (index + 1)) + EVENT_GAP + this_1.moreIndicatorHeight;\n                    if (this_1.parent.activeViewOptions.orientation === 'Horizontal') {\n                        var isRendered = this_1.renderedEvents.filter(function (eventObj) {\n                            return eventObj.Guid === eventData.Guid;\n                        });\n                        if (isRendered.length > 0) {\n                            return \"continue\";\n                        }\n                    }\n                    if (this_1.cellHeight > availedHeight) {\n                        this_1.renderEvent(eventWrapper, eventData, row, leftValue, overlapIndex, dayIndex);\n                    }\n                    else {\n                        var moreIndex = this_1.parent.activeViewOptions.orientation === 'Horizontal' ? row : dayIndex;\n                        this_1.renderMoreIndicatior(eventWrapper, count - index, dayStart, moreIndex, leftValue, dayEvents);\n                        if (this_1.parent.activeViewOptions.orientation === 'Horizontal') {\n                            for (var a = index; a < dayEvents.length; a++) {\n                                var moreData = extend({}, dayEvents[a], { Index: overlapIndex + a }, true);\n                                this_1.renderedEvents.push(moreData);\n                            }\n                        }\n                        return \"break\";\n                    }\n                };\n                var this_1 = this;\n                for (var index = 0, count = dayEvents.length; index < count; index++) {\n                    var state_1 = _loop_1(index, count);\n                    if (state_1 === \"break\")\n                        break;\n                }\n                monthStart = util.addDays(new Date(monthStart.getTime()), 1);\n                if (this.parent.activeViewOptions.orientation === 'Vertical') {\n                    dayIndex++;\n                    this.renderedEvents = [];\n                }\n            }\n        }\n    };\n    YearEvent.prototype.renderEvent = function (wrapper, eventData, row, left, overlapCount, rowIndex) {\n        var _this = this;\n        var eventObj = this.isSpannedEvent(eventData, row);\n        var wrap = this.createEventElement(eventObj);\n        var width;\n        var top;\n        if (this.parent.activeViewOptions.orientation === 'Horizontal') {\n            width = eventObj.isSpanned.count * this.cellWidth;\n            top = this.cellHeader + (this.eventHeight * overlapCount) + EVENT_GAP + (this.cellHeight * row);\n        }\n        else {\n            width = this.cellWidth;\n            top = (this.cellHeight * rowIndex) + this.cellHeader + (this.eventHeight * overlapCount) + EVENT_GAP;\n        }\n        setStyleAttribute(wrap, { 'width': width + 'px', 'height': this.eventHeight + 'px', 'left': left + 'px', 'top': top + 'px' });\n        var args = { data: eventObj, element: wrap, cancel: false, type: 'event' };\n        this.parent.trigger(events.eventRendered, args, function (eventArgs) {\n            if (!eventArgs.cancel) {\n                wrapper.appendChild(wrap);\n                _this.wireAppointmentEvents(wrap, eventObj, true);\n                _this.renderedEvents.push(extend({}, eventObj, null, true));\n            }\n        });\n    };\n    YearEvent.prototype.renderMoreIndicatior = function (wrapper, count, startDate, row, left, events) {\n        var endDate = util.addDays(new Date(startDate.getTime()), 1);\n        var moreIndicator = this.getMoreIndicatorElement(count, startDate, endDate);\n        var rowTr = this.parent.element.querySelector(\".e-content-wrap tr:nth-child(\" + (row + 1) + \")\");\n        var top = rowTr.offsetTop + (this.cellHeight - this.moreIndicatorHeight);\n        left = (Math.floor(left / this.cellWidth) * this.cellWidth);\n        setStyleAttribute(moreIndicator, { 'width': this.cellWidth + 'px', 'left': left + 'px', 'top': top + 'px' });\n        wrapper.appendChild(moreIndicator);\n        EventHandler.add(moreIndicator, 'click', this.moreIndicatorClick, this);\n    };\n    YearEvent.prototype.createEventElement = function (record) {\n        var eventSubject = (record[this.fields.subject] || this.parent.eventSettings.fields.subject.default);\n        var eventWrapper = createElement('div', {\n            className: cls.APPOINTMENT_CLASS,\n            attrs: {\n                'data-id': 'Appointment_' + record[this.fields.id],\n                'data-guid': record.Guid,\n                'role': 'button', 'tabindex': '0',\n                'aria-readonly': this.parent.eventBase.getReadonlyAttribute(record), 'aria-selected': 'false', 'aria-grabbed': 'true'\n            }\n        });\n        if (this.cssClass) {\n            addClass([eventWrapper], this.cssClass);\n        }\n        if (record[this.fields.isReadonly]) {\n            addClass([eventWrapper], cls.READ_ONLY);\n        }\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            var resIndex = this.getGroupIndexFromEvent(record);\n            eventWrapper.setAttribute('data-group-index', resIndex.toString());\n        }\n        var templateElement = [];\n        var eventObj = extend({}, record, null, true);\n        if (this.parent.activeViewOptions.eventTemplate) {\n            var templateId = this.parent.element.id + '_' + this.parent.activeViewOptions.eventTemplateName + 'eventTemplate';\n            var templateArgs = util.addLocalOffsetToEvent(eventObj, this.parent.eventFields);\n            templateElement = this.parent.getAppointmentTemplate()(templateArgs, this.parent, 'eventTemplate', templateId, false);\n        }\n        else {\n            var locationEle = (record[this.fields.location] || this.parent.eventSettings.fields.location.default || '');\n            var subjectEle = createElement('div', {\n                className: cls.SUBJECT_CLASS,\n                innerHTML: (eventSubject + (locationEle ? ';&nbsp' + locationEle : ''))\n            });\n            var startTimeEle = createElement('div', {\n                className: cls.APPOINTMENT_TIME + (this.parent.isAdaptive ? ' ' + cls.DISABLE_CLASS : ''),\n                innerHTML: this.parent.getTimeString(eventObj[this.fields.startTime])\n            });\n            var endTimeEle = createElement('div', {\n                className: cls.APPOINTMENT_TIME + (this.parent.isAdaptive ? ' ' + cls.DISABLE_CLASS : ''),\n                innerHTML: this.parent.getTimeString(eventObj[this.fields.endTime])\n            });\n            addClass([subjectEle], 'e-text-center');\n            if (record[this.fields.isAllDay]) {\n                templateElement = [subjectEle];\n            }\n            else if (!eventObj.isLeft && !eventObj.isRight) {\n                templateElement = [startTimeEle, subjectEle, endTimeEle];\n            }\n            else {\n                if (!eventObj.isLeft) {\n                    templateElement.push(startTimeEle);\n                }\n                templateElement.push(subjectEle);\n                if (!eventObj.isRight) {\n                    templateElement.push(endTimeEle);\n                }\n            }\n        }\n        var appointmentDetails = createElement('div', { className: cls.APPOINTMENT_DETAILS });\n        append(templateElement, appointmentDetails);\n        eventWrapper.appendChild(appointmentDetails);\n        this.applyResourceColor(eventWrapper, eventObj, 'backgroundColor', this.groupOrder);\n        return eventWrapper;\n    };\n    YearEvent.prototype.isSpannedEvent = function (eventObj, month) {\n        var monthStart = new Date(this.parent.selectedDate.getFullYear(), month, 1);\n        var monthEnd = util.addDays(new Date(this.parent.selectedDate.getFullYear(), month + 1, 0), 1);\n        var eventData = extend({}, eventObj, null, true);\n        var eventStart = eventData[this.fields.startTime];\n        var eventEnd = eventData[this.fields.endTime];\n        eventData.isSpanned = {\n            count: Math.ceil((eventEnd.getTime() - eventStart.getTime()) / util.MS_PER_DAY),\n            isLeft: eventStart.getTime() < monthStart.getTime(),\n            isRight: eventEnd.getTime() > monthEnd.getTime()\n        };\n        return eventData;\n    };\n    YearEvent.prototype.getOverlapEvents = function (date, appointments) {\n        var appointmentsList = [];\n        for (var _i = 0, _a = appointments; _i < _a.length; _i++) {\n            var app = _a[_i];\n            var appStart = new Date(app[this.fields.startTime].getTime());\n            var appEnd = new Date(app[this.fields.endTime].getTime());\n            if ((util.resetTime(appStart).getTime() <= util.resetTime(new Date(date.getTime())).getTime()) &&\n                (util.resetTime(appEnd).getTime() >= util.resetTime(new Date(date.getTime())).getTime())) {\n                appointmentsList.push(app);\n            }\n        }\n        return appointmentsList;\n    };\n    return YearEvent;\n}(TimelineEvent));\nexport { YearEvent };\n"]},"metadata":{},"sourceType":"module"}