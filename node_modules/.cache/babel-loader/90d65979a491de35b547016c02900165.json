{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component,Fragment}from\"react\";import{connect}from\"react-redux\";import{bindActionCreators,compose}from\"redux\";import Header from\"../header/Header\";import Sidebar from\"../sidebar/Sidebar\";import NotFound from\"../not-found/NotFound\";import MessageList from\"../content/message-list/MessageList\";import MessageContent from\"../content/message-list/message-content/MessageContent\";import{Route,Switch,withRouter}from\"react-router-dom\";import{getLabels}from\"../sidebar/sidebar.actions\";import{getLabelMessages,emptyLabelMessages,toggleSelected,setPageTokens,addInitialPageToken,clearPageTokens,setSearchQuery}from\"../content/message-list/actions/message-list.actions\";import{selectLabel}from'../sidebar/sidebar.actions';import{signOut}from'../../api/authentication';import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faSpinner}from\"@fortawesome/free-solid-svg-icons\";export var Main=/*#__PURE__*/function(_Component){_inherits(Main,_Component);var _super=_createSuper(Main);function Main(props){var _this;_classCallCheck(this,Main);_this=_super.call(this,props);_this.getLabelList=_this.getLabelList.bind(_assertThisInitialized(_this));_this.getLabelMessages=_this.getLabelMessages.bind(_assertThisInitialized(_this));_this.renderLabelRoutes=_this.renderLabelRoutes.bind(_assertThisInitialized(_this));_this.loadLabelMessages=_this.loadLabelMessages.bind(_assertThisInitialized(_this));_this.navigateToNextPage=_this.navigateToNextPage.bind(_assertThisInitialized(_this));_this.navigateToPrevPage=_this.navigateToPrevPage.bind(_assertThisInitialized(_this));_this.addInitialPageToken=_this.addInitialPageToken.bind(_assertThisInitialized(_this));_this.onSignout=_this.onSignout.bind(_assertThisInitialized(_this));return _this;}_createClass(Main,[{key:\"componentDidMount\",value:function componentDidMount(){/* Label list is fetched from here \r\n    so that we can declare Routes by labelId \r\n    before rendering anything else */this.getLabelList();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){if(prevProps.signedInUser!==this.props.signedInUser){this.setState({signedInUser:this.props.signedInUser});}var labels=this.props.labelsResult.labels;var pathname=this.props.location.pathname;var selectedLabel=labels.find(function(el){return el.selected;});var labelPathMatch=labels.find(function(el){return el.id.toLowerCase()===pathname.slice(1);});console.log(pathname,\"pathname\");if(!selectedLabel){if(labelPathMatch&&this.props.searchQuery===\"\"){this.props.selectLabel(labelPathMatch.id);}}else{if(labelPathMatch&&selectedLabel.id!==labelPathMatch.id){this.props.selectLabel(labelPathMatch.id);}}}},{key:\"getClickHandler\",value:function getClickHandler(action){var _this2=this;return function(evt){_this2.props.onClick(action);};}},{key:\"navigateToNextPage\",value:function navigateToNextPage(token){var searchParam=this.props.location.search;var currentToken=searchParam.indexOf(\"?\")===0?searchParam.slice(1):\"\";this.props.setPageTokens({prevPageToken:currentToken});this.props.history.push(token);}},{key:\"navigateToPrevPage\",value:function navigateToPrevPage(token){this.props.history.push(token);}},{key:\"loadLabelMessages\",value:function loadLabelMessages(label){var currentSearchQuery=this.props.searchQuery;this.props.clearPageTokens();this.props.selectLabel(label.id);var newPathToPush=\"/\".concat(label.id.toLowerCase());if(currentSearchQuery&&currentSearchQuery!==\"\"){this.props.setSearchQuery(\"\");var pathname=this.props.location.pathname;if(newPathToPush===pathname){this.getLabelMessages({labelIds:[label.id]});return;}}this.props.history.push(\"/\".concat(label.id.toLowerCase()));}},{key:\"getLabelList\",value:function getLabelList(){this.props.getLabels();}},{key:\"getLabelMessages\",value:function getLabelMessages(_ref){var labelIds=_ref.labelIds,q=_ref.q,pageToken=_ref.pageToken;this.props.emptyLabelMessages();this.props.getLabelMessages({labelIds:labelIds,q:q,pageToken:pageToken});}},{key:\"addInitialPageToken\",value:function addInitialPageToken(token){this.props.addInitialPageToken(token);}},{key:\"renderLabelRoutes\",value:function renderLabelRoutes(){var _this3=this;return this.props.labelsResult.labels.map(function(el){return/*#__PURE__*/React.createElement(Route,{key:el.id+'_route',exact:true,path:\"/\"+el.id,render:function render(props){var that=_this3;return/*#__PURE__*/React.createElement(MessageList,Object.assign({},props,{getLabelMessages:_this3.getLabelMessages,messagesResult:_this3.props.messagesResult,toggleSelected:_this3.props.toggleSelected,navigateToNextPage:_this3.navigateToNextPage,navigateToPrevPage:_this3.navigateToPrevPage,pageTokens:_this3.props.pageTokens,addInitialPageToken:_this3.addInitialPageToken,parentLabel:that.props.labelsResult.labels.find(function(el){return el.id===props.match.path.slice(1);}),searchQuery:_this3.props.searchQuery}));}});});}},{key:\"renderSpinner\",value:function renderSpinner(){return/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex h-100 align-items-center justify-content-center\"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faSpinner,spin:true,size:\"5x\"}));}},{key:\"onSignout\",value:function onSignout(){var that=this;signOut().then(function(_){that.props.history.replace('inbox');window.location.reload(true);});}},{key:\"renderInboxViewport\",value:function renderInboxViewport(){if(this.props.labelsResult.labels.length<1){return this.renderSpinner();}return/*#__PURE__*/React.createElement(Fragment,null,/*#__PURE__*/React.createElement(Header,{googleUser:this.props.googleUser,onSignout:this.onSignout,setSearchQuery:this.props.setSearchQuery,getLabelMessages:this.getLabelMessages,searchQuery:this.props.searchQuery}),/*#__PURE__*/React.createElement(Sidebar,{getLabelList:this.getLabelList,pathname:this.props.location.pathname,labelsResult:this.props.labelsResult,onLabelClick:this.loadLabelMessages}),/*#__PURE__*/React.createElement(\"article\",{className:\"d-flex flex-column  \"},/*#__PURE__*/React.createElement(Switch,null,this.renderLabelRoutes(),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/notfound\",component:NotFound}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/:id([a-zA-Z0-9]+)\",component:MessageContent}))));}},{key:\"render\",value:function render(){return this.renderInboxViewport();}}]);return Main;}(Component);var mapStateToProps=function mapStateToProps(state){return{labelsResult:state.labelsResult,messagesResult:state.messagesResult,pageTokens:state.pageTokens,searchQuery:state.searchQuery};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return bindActionCreators({getLabels:getLabels,getLabelMessages:getLabelMessages,emptyLabelMessages:emptyLabelMessages,toggleSelected:toggleSelected,selectLabel:selectLabel,setPageTokens:setPageTokens,addInitialPageToken:addInitialPageToken,clearPageTokens:clearPageTokens,setSearchQuery:setSearchQuery},dispatch);};export default compose(withRouter,connect(mapStateToProps,mapDispatchToProps))(Main);","map":{"version":3,"sources":["C:/Users/grigo/OneDrive/Рабочий стол/CRM/src/components/main/Main.jsx"],"names":["React","Component","Fragment","connect","bindActionCreators","compose","Header","Sidebar","NotFound","MessageList","MessageContent","Route","Switch","withRouter","getLabels","getLabelMessages","emptyLabelMessages","toggleSelected","setPageTokens","addInitialPageToken","clearPageTokens","setSearchQuery","selectLabel","signOut","FontAwesomeIcon","faSpinner","Main","props","getLabelList","bind","renderLabelRoutes","loadLabelMessages","navigateToNextPage","navigateToPrevPage","onSignout","prevProps","prevState","signedInUser","setState","labels","labelsResult","pathname","location","selectedLabel","find","el","selected","labelPathMatch","id","toLowerCase","slice","console","log","searchQuery","action","evt","onClick","token","searchParam","search","currentToken","indexOf","prevPageToken","history","push","label","currentSearchQuery","newPathToPush","labelIds","q","pageToken","map","that","messagesResult","pageTokens","match","path","then","_","replace","window","reload","length","renderSpinner","googleUser","renderInboxViewport","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { bindActionCreators, compose } from \"redux\";\r\nimport Header from \"../header/Header\";\r\nimport Sidebar from \"../sidebar/Sidebar\";\r\nimport NotFound from \"../not-found/NotFound\";\r\n\r\nimport MessageList from \"../content/message-list/MessageList\";\r\nimport MessageContent from \"../content/message-list/message-content/MessageContent\";\r\n\r\nimport { Route, Switch, withRouter} from \"react-router-dom\";\r\n\r\nimport { getLabels } from \"../sidebar/sidebar.actions\";\r\n\r\nimport {\r\n  getLabelMessages,\r\n  emptyLabelMessages,\r\n  toggleSelected,\r\n  setPageTokens,\r\n  addInitialPageToken,\r\n  clearPageTokens,\r\n  setSearchQuery\r\n} from \"../content/message-list/actions/message-list.actions\";\r\n\r\nimport {selectLabel} from '../sidebar/sidebar.actions';\r\nimport {signOut} from '../../api/authentication';\r\n\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faSpinner } from \"@fortawesome/free-solid-svg-icons\";\r\n\r\n\r\nexport class Main extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.getLabelList = this.getLabelList.bind(this);\r\n    this.getLabelMessages = this.getLabelMessages.bind(this);\r\n    this.renderLabelRoutes = this.renderLabelRoutes.bind(this);\r\n    this.loadLabelMessages = this.loadLabelMessages.bind(this);\r\n    this.navigateToNextPage = this.navigateToNextPage.bind(this);\r\n    this.navigateToPrevPage = this.navigateToPrevPage.bind(this);\r\n    this.addInitialPageToken = this.addInitialPageToken.bind(this);\r\n    this.onSignout = this.onSignout.bind(this);\r\n\r\n  \r\n  }\r\n\r\n \r\n  componentDidMount() {\r\n    /* Label list is fetched from here \r\n    so that we can declare Routes by labelId \r\n    before rendering anything else */\r\n    this.getLabelList();\r\n    \r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevProps.signedInUser !== this.props.signedInUser) {\r\n      this.setState({\r\n        signedInUser: this.props.signedInUser\r\n      });\r\n    }\r\n     \r\n    const {labels} = this.props.labelsResult;\r\n    const {pathname} = this.props.location;\r\n    const selectedLabel = labels.find(el => el.selected);\r\n    const labelPathMatch = labels.find(el => el.id.toLowerCase() === pathname.slice(1));\r\n    \r\n    \r\n    console.log(pathname,\"pathname\")\r\n    if (!selectedLabel) {\r\n      if (labelPathMatch && this.props.searchQuery === \"\") {\r\n        this.props.selectLabel(labelPathMatch.id);\r\n      }      \r\n    }\r\n    else {\r\n      if (labelPathMatch && selectedLabel.id !== labelPathMatch.id) {\r\n        this.props.selectLabel(labelPathMatch.id);\r\n      } \r\n    }\r\n  }\r\n\r\n  getClickHandler(action) {\r\n   \r\nreturn evt => {\r\n      this.props.onClick(action);\r\n    };\r\n  }\r\n  navigateToNextPage(token) {\r\n    const searchParam = this.props.location.search;\r\n    const currentToken = searchParam.indexOf(\"?\") === 0 ? searchParam.slice(1) : \"\";\r\n    this.props.setPageTokens({\r\n      prevPageToken: currentToken\r\n    });\r\n    this.props.history.push(token);\r\n  }\r\n\r\n  navigateToPrevPage(token) {\r\n    this.props.history.push(token);\r\n  }\r\n\r\n  loadLabelMessages(label) {\r\n    \r\n    const currentSearchQuery = this.props.searchQuery;\r\n    this.props.clearPageTokens();\r\n    this.props.selectLabel(label.id);    \r\n\r\n    const newPathToPush = `/${label.id.toLowerCase()}`;\r\n\r\n    if (currentSearchQuery && currentSearchQuery !== \"\") {\r\n      this.props.setSearchQuery(\"\");\r\n      const {pathname} = this.props.location;\r\n      if (newPathToPush === pathname) {\r\n        this.getLabelMessages({labelIds: [label.id] });\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.props.history.push(`/${label.id.toLowerCase()}`);\r\n  }\r\n  \r\n\r\n  getLabelList() {\r\n    this.props.getLabels();\r\n  }\r\n\r\n  getLabelMessages({labelIds, q, pageToken}) {\r\n    this.props.emptyLabelMessages();    \r\n    this.props.getLabelMessages({labelIds, q, pageToken});\r\n  }\r\n\r\n\r\n  addInitialPageToken(token) {\r\n    this.props.addInitialPageToken(token);\r\n  }\r\n\r\n  renderLabelRoutes() {\r\n\r\n    return this.props.labelsResult.labels.map(el => (\r\n      <Route\r\n        key={el.id + '_route'}\r\n        exact\r\n        path={\"/\" + el.id}\r\n        render={props => {          \r\n          const that = this;\r\n          return (\r\n            <MessageList\r\n              {...props}\r\n              getLabelMessages={this.getLabelMessages}\r\n              messagesResult={this.props.messagesResult}\r\n              toggleSelected={this.props.toggleSelected}\r\n              navigateToNextPage={this.navigateToNextPage}\r\n              navigateToPrevPage={this.navigateToPrevPage}\r\n              pageTokens={this.props.pageTokens}\r\n              addInitialPageToken={this.addInitialPageToken}\r\n              parentLabel={that.props.labelsResult.labels.find(el => el.id === props.match.path.slice(1) )}\r\n              searchQuery={this.props.searchQuery}\r\n            />\r\n          )\r\n        }}\r\n      />\r\n    ));    \r\n  }\r\n\r\n  renderSpinner() {\r\n    return (\r\n      <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <FontAwesomeIcon icon={faSpinner} spin size=\"5x\" />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  onSignout() {\r\n    const that = this;\r\n    signOut().then(_ => {\r\n      that.props.history.replace('inbox');\r\n      window.location.reload(true);\r\n    })\r\n  }\r\n\r\n  renderInboxViewport() {\r\n\r\n    if (this.props.labelsResult.labels.length < 1) {\r\n      return this.renderSpinner();\r\n    }\r\n\r\n    return (\r\n      <Fragment>\r\n        <Header \r\n       googleUser={this.props.googleUser} \r\n         onSignout={this.onSignout} \r\n         setSearchQuery={this.props.setSearchQuery}\r\n         getLabelMessages={this.getLabelMessages} \r\n          searchQuery={this.props.searchQuery}\r\n        />\r\n        {/* <section className=\"main hbox space-between\"> */}\r\n         \r\n          <Sidebar\r\n            getLabelList={this.getLabelList}\r\n            pathname={this.props.location.pathname}\r\n            labelsResult={this.props.labelsResult}\r\n            onLabelClick={this.loadLabelMessages}\r\n          />\r\n          <article className=\"d-flex flex-column  \">\r\n         \r\n            <Switch>\r\n              {this.renderLabelRoutes()}\r\n              <Route\r\n                exact\r\n                path=\"/notfound\"\r\n                component={NotFound}\r\n              />\r\n              <Route\r\n                exact\r\n                path=\"/:id([a-zA-Z0-9]+)\"\r\n                component={MessageContent}\r\n              />\r\n            </Switch>\r\n          </article>\r\n        {/* </section> */}\r\n      </Fragment>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return this.renderInboxViewport();\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n  labelsResult: state.labelsResult,\r\n  messagesResult: state.messagesResult,\r\n  pageTokens: state.pageTokens,\r\n  searchQuery: state.searchQuery\r\n});\r\n\r\nconst mapDispatchToProps = dispatch =>\r\n  bindActionCreators(\r\n    {\r\n      getLabels,\r\n      getLabelMessages,\r\n      emptyLabelMessages,\r\n      toggleSelected,\r\n      selectLabel,\r\n      setPageTokens,\r\n      addInitialPageToken,\r\n      clearPageTokens,\r\n      setSearchQuery\r\n    },\r\n    dispatch\r\n  );\r\n\r\nexport default compose(\r\n  withRouter,\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )\r\n)(Main);\r\n"]},"metadata":{},"sourceType":"module"}