{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { isNullOrUndefined, setStyleAttribute, extend, EventHandler, createElement } from '@syncfusion/ej2-base';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\nimport { MonthEvent } from './month';\nvar EVENT_GAP = 2;\nvar BLOCK_INDICATOR_WIDTH = 22;\nvar BLOCK_INDICATOR_HEIGHT = 18;\n/**\n * Timeline view events render\n */\n\nvar TimelineEvent =\n/** @class */\nfunction (_super) {\n  __extends(TimelineEvent, _super);\n  /**\n   * Constructor for timeline views\n   */\n\n\n  function TimelineEvent(parent, type) {\n    var _this = _super.call(this, parent) || this;\n\n    _this.startHour = _this.parent.activeView.getStartHour();\n    _this.endHour = _this.parent.activeView.getEndHour();\n    _this.slotCount = _this.parent.activeViewOptions.timeScale.slotCount;\n    _this.interval = _this.parent.activeViewOptions.timeScale.interval;\n    _this.day = 0;\n    _this.rowIndex = 0;\n    _this.renderType = type;\n    _this.appContainers = [].slice.call(_this.element.querySelectorAll('.' + cls.APPOINTMENT_CONTAINER_CLASS));\n    _this.dayLength = _this.element.querySelectorAll('.' + cls.CONTENT_TABLE_CLASS + ' tbody tr').length === 0 ? 0 : _this.element.querySelectorAll('.' + cls.CONTENT_TABLE_CLASS + ' tbody tr')[0].children.length;\n    _this.content = _this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n    return _this;\n  }\n\n  TimelineEvent.prototype.getSlotDates = function () {\n    this.slots = [];\n    this.slots.push(this.parent.activeView.renderDates.map(function (date) {\n      return +date;\n    }));\n\n    if (this.parent.headerRows.length > 0 && this.parent.headerRows[this.parent.headerRows.length - 1].option !== 'Hour') {\n      this.renderType = 'day';\n      this.cellWidth = this.content.offsetWidth / this.dateRender.length;\n      this.slotsPerDay = 1;\n    } else {\n      this.slotsPerDay = this.dayLength / this.dateRender.length;\n    }\n  };\n\n  TimelineEvent.prototype.getOverlapEvents = function (date, appointments) {\n    var appointmentsList = [];\n\n    if (this.renderType === 'day') {\n      for (var _i = 0, appointments_1 = appointments; _i < appointments_1.length; _i++) {\n        var app = appointments_1[_i];\n\n        if (util.resetTime(app[this.fields.startTime]).getTime() <= util.resetTime(new Date(date.getTime())).getTime() && util.resetTime(app[this.fields.endTime]).getTime() >= util.resetTime(new Date(date.getTime())).getTime()) {\n          appointmentsList.push(app);\n        }\n      }\n    } else {\n      for (var _a = 0, appointments_2 = appointments; _a < appointments_2.length; _a++) {\n        var app = appointments_2[_a];\n        var eventData = app.data;\n\n        if (eventData.trimStartTime.getTime() <= date.getTime() && eventData.trimEndTime.getTime() > date.getTime()) {\n          appointmentsList.push(app);\n        }\n      }\n    }\n\n    return appointmentsList;\n  };\n\n  TimelineEvent.prototype.renderResourceEvents = function () {\n    this.removeHeightProperty(cls.RESOURCE_COLUMN_TABLE_CLASS);\n    var resources = this.parent.uiStateValues.isGroupAdaptive ? [this.parent.resourceBase.lastResourceLevel[this.parent.uiStateValues.groupIndex]] : this.parent.resourceBase.renderedResources;\n\n    for (var i = 0; i < resources.length; i++) {\n      this.rowIndex = i;\n      this.renderEventsHandler(this.parent.activeView.renderDates, this.parent.activeViewOptions.workDays, resources[i]);\n    }\n  };\n\n  TimelineEvent.prototype.renderEvents = function (event, resIndex, appointmentsList) {\n    var startTime = event[this.fields.startTime];\n    var endTime = event[this.fields.endTime];\n\n    if (startTime.getTime() < this.parent.minDate.getTime() || endTime.getTime() > this.parent.maxDate.getTime()) {\n      return;\n    }\n\n    var eventData = event.data;\n    startTime = this.getStartTime(event, eventData);\n    endTime = this.getEndTime(event, eventData);\n    this.day = this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(startTime.getTime())));\n\n    if (this.day < 0) {\n      return;\n    }\n\n    var cellTd = this.getCellTd();\n    var overlapCount = this.getIndex(startTime);\n    event.Index = overlapCount;\n    var appHeight = this.eventHeight;\n    var diffInDays = eventData.count;\n\n    if (startTime <= endTime) {\n      var appWidth = this.getEventWidth(startTime, endTime, event[this.fields.isAllDay], diffInDays);\n      appWidth = this.renderType === 'day' ? appWidth - 2 : appWidth;\n      var appLeft = 0;\n      var appRight = 0;\n      var position = this.getPosition(startTime, endTime, event[this.fields.isAllDay], this.day);\n      appWidth = appWidth <= 0 ? this.cellWidth : appWidth; // appWidth 0 when start and end time as same\n\n      this.renderedEvents.push(extend({}, event, null, true));\n      var top_1 = this.getRowTop(resIndex);\n      var appTop = top_1 + EVENT_GAP + overlapCount * (appHeight + EVENT_GAP);\n      appLeft = this.parent.enableRtl ? 0 : position;\n      appRight = this.parent.enableRtl ? position : 0;\n      var height = (overlapCount + 1) * (appHeight + EVENT_GAP) + this.moreIndicatorHeight;\n\n      if (this.cellHeight > height || this.parent.rowAutoHeight) {\n        var appointmentElement = this.createAppointmentElement(event, resIndex);\n        this.applyResourceColor(appointmentElement, event, 'backgroundColor', this.groupOrder);\n        setStyleAttribute(appointmentElement, {\n          'width': appWidth + 'px',\n          'left': appLeft + 'px',\n          'right': appRight + 'px',\n          'top': appTop + 'px'\n        });\n        this.wireAppointmentEvents(appointmentElement, event);\n        this.renderEventElement(event, appointmentElement, cellTd);\n\n        if (this.parent.rowAutoHeight) {\n          var firstChild = this.getFirstChild(resIndex);\n          this.updateCellHeight(firstChild, height);\n        }\n      } else {\n        for (var i = 0; i < diffInDays; i++) {\n          var moreIndicator = cellTd.querySelector('.' + cls.MORE_INDICATOR_CLASS);\n          var appPos = this.parent.enableRtl ? appRight : appLeft;\n          appPos = Math.floor(appPos / this.cellWidth) * this.cellWidth;\n\n          if (cellTd && isNullOrUndefined(moreIndicator) || !this.isAlreadyAvail(appPos, cellTd)) {\n            var interval = this.interval / this.slotCount;\n            var startDate = new Date(this.dateRender[this.day + i].getTime());\n            var endDate = util.addDays(this.dateRender[this.day + i], 1);\n            var startDateTime = new Date(+startTime);\n            var slotStartTime = new Date(startDateTime.setMinutes(Math.floor(startDateTime.getMinutes() / interval) * interval));\n            var slotEndTime = new Date(slotStartTime.getTime() + 60000 * interval);\n            var groupIndex = void 0;\n\n            if (this.parent.activeViewOptions.group.resources.length > 0 && !isNullOrUndefined(resIndex)) {\n              groupIndex = resIndex.toString();\n            }\n\n            var filterEvents = this.getFilterEvents(startDate, endDate, slotStartTime, slotEndTime, groupIndex, appointmentsList);\n            var appArea = this.cellHeight - this.moreIndicatorHeight;\n            var renderedAppCount = Math.floor(appArea / (appHeight + EVENT_GAP));\n            var count = filterEvents.length - renderedAppCount <= 0 ? 1 : filterEvents.length - renderedAppCount;\n            var moreIndicatorElement = void 0;\n\n            if (this.renderType === 'day') {\n              moreIndicatorElement = this.getMoreIndicatorElement(count, startDate, endDate);\n            } else {\n              moreIndicatorElement = this.getMoreIndicatorElement(count, slotStartTime, slotEndTime);\n            }\n\n            if (!isNullOrUndefined(groupIndex)) {\n              moreIndicatorElement.setAttribute('data-group-index', groupIndex);\n            }\n\n            moreIndicatorElement.style.top = top_1 + appArea + 'px';\n            moreIndicatorElement.style.width = this.cellWidth + 'px';\n            moreIndicatorElement.style.left = Math.floor(appLeft / this.cellWidth) * this.cellWidth + 'px';\n            moreIndicatorElement.style.right = Math.floor(appRight / this.cellWidth) * this.cellWidth + 'px';\n            this.renderElement(cellTd, moreIndicatorElement);\n            EventHandler.add(moreIndicatorElement, 'click', this.moreIndicatorClick, this);\n          }\n        }\n      }\n    }\n  };\n\n  TimelineEvent.prototype.updateCellHeight = function (cell, height) {\n    if (height > cell.offsetHeight) {\n      setStyleAttribute(cell, {\n        'height': height + 'px'\n      });\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        var resourceCell = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_TABLE_CLASS + ' ' + 'tbody td[data-group-index=\"' + cell.getAttribute('data-group-index') + '\"]');\n        setStyleAttribute(resourceCell, {\n          'height': height + 'px'\n        });\n      }\n    }\n  };\n\n  TimelineEvent.prototype.getFirstChild = function (index) {\n    var query = '.' + cls.CONTENT_TABLE_CLASS + ' tbody td';\n    var groupIndex = '';\n\n    if (this.parent.activeViewOptions.group.resources.length > 0) {\n      groupIndex = '[data-group-index=\"' + index.toString() + '\"]';\n    }\n\n    var td = this.parent.element.querySelector(query + groupIndex);\n    return td;\n  };\n\n  TimelineEvent.prototype.updateBlockElements = function () {\n    var blockElement = [].slice.call(this.element.querySelectorAll('.' + cls.BLOCK_APPOINTMENT_CLASS));\n\n    for (var _i = 0, blockElement_1 = blockElement; _i < blockElement_1.length; _i++) {\n      var element = blockElement_1[_i];\n      var resIndex = parseInt(element.getAttribute('data-group-index'), 10);\n      var firstChild = this.getFirstChild(resIndex);\n      element.style.height = firstChild.offsetHeight + 'px';\n      var width = Math.round(element.offsetWidth / firstChild.offsetWidth);\n      element.style.width = firstChild.offsetWidth * width + 'px';\n    }\n\n    var blockIndicator = [].slice.call(this.element.querySelectorAll('.' + cls.BLOCK_INDICATOR_CLASS));\n\n    for (var _a = 0, blockIndicator_1 = blockIndicator; _a < blockIndicator_1.length; _a++) {\n      var element = blockIndicator_1[_a];\n      var resIndex = parseInt(element.getAttribute('data-group-index'), 10);\n      element.style.top = this.getRowTop(resIndex) + this.getFirstChild(resIndex).offsetHeight - BLOCK_INDICATOR_HEIGHT + 'px';\n    }\n  };\n\n  TimelineEvent.prototype.getStartTime = function (event, eventData) {\n    var startTime = event[this.fields.startTime];\n    var schedule = util.getStartEndHours(startTime, this.startHour, this.endHour);\n\n    if (schedule.startHour.getTime() >= eventData[this.fields.startTime]) {\n      startTime = schedule.startHour;\n    } else if (schedule.endHour.getTime() <= eventData[this.fields.startTime]) {\n      startTime = this.getNextDay(schedule.startHour, eventData);\n    } else {\n      startTime = eventData[this.fields.startTime];\n    } // To overcome the overflow\n\n\n    eventData.trimStartTime = event[this.fields.isAllDay] ? schedule.startHour : eventData[this.fields.startTime];\n    return startTime;\n  };\n\n  TimelineEvent.prototype.getNextDay = function (startTime, eventData) {\n    var startDate;\n\n    for (var i = 1; i <= this.dateRender.length; i++) {\n      startDate = util.addDays(startTime, i);\n\n      if (this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(startTime.getTime()))) !== -1) {\n        eventData.count = eventData.count - 1;\n        return startDate;\n      }\n    }\n\n    return startDate;\n  };\n\n  TimelineEvent.prototype.getEndTime = function (event, eventData) {\n    var endTime = event[this.fields.endTime];\n    var schedule = util.getStartEndHours(endTime, this.startHour, this.endHour);\n\n    if (schedule.endHour.getTime() <= eventData[this.fields.endTime]) {\n      endTime = schedule.endHour;\n    } else {\n      endTime = eventData[this.fields.endTime];\n    } // To overcome the overflow\n\n\n    eventData.trimEndTime = event[this.fields.isAllDay] ? schedule.endHour : eventData[this.fields.endTime];\n    return endTime;\n  };\n\n  TimelineEvent.prototype.getEventWidth = function (startDate, endDate, isAllDay, count) {\n    if (this.renderType === 'day' || isAllDay) {\n      return count * this.slotsPerDay * this.cellWidth;\n    }\n\n    if (this.isSameDay(startDate, endDate)) {\n      return this.getSameDayEventsWidth(startDate, endDate);\n    } else {\n      return this.getSpannedEventsWidth(startDate, endDate, count);\n    }\n  };\n\n  TimelineEvent.prototype.getSameDayEventsWidth = function (startDate, endDate) {\n    return (endDate.getTime() - startDate.getTime()) / (60 * 1000) * (this.cellWidth * this.slotCount) / this.interval;\n  };\n\n  TimelineEvent.prototype.getSpannedEventsWidth = function (startDate, endDate, diffInDays) {\n    var width = diffInDays * this.slotsPerDay * this.cellWidth;\n    var startWidth;\n    var endWidth;\n    var start = util.getStartEndHours(util.resetTime(new Date(startDate.getTime())), this.startHour, this.endHour);\n    startWidth = this.getSameDayEventsWidth(start.startHour, startDate);\n\n    if (this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(endDate.getTime()))) === -1) {\n      endWidth = 0;\n    } else {\n      var end = util.getStartEndHours(util.resetTime(new Date(endDate.getTime())), this.startHour, this.endHour);\n      endWidth = this.getSameDayEventsWidth(endDate, end.endHour);\n      endWidth = this.slotsPerDay * this.cellWidth === endWidth ? 0 : endWidth;\n    }\n\n    var spannedWidth = startWidth + endWidth;\n    return width > spannedWidth ? width - spannedWidth : endWidth - startWidth;\n  };\n\n  TimelineEvent.prototype.isSameDay = function (startTime, endTime) {\n    var startDay = this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(startTime.getTime())));\n    var endDay = this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(endTime.getTime())));\n    return startDay === endDay;\n  };\n\n  TimelineEvent.prototype.getAppointmentLeft = function (schedule, startTime, day) {\n    var slotTd = this.isSameDay(startTime, schedule.startHour) ? (startTime.getTime() - schedule.startHour.getTime()) / (60 * 1000 * this.interval) * this.slotCount : 0;\n\n    if (day === 0) {\n      return slotTd;\n    } else {\n      var daySlot = (schedule.endHour.getTime() - schedule.startHour.getTime()) / (60 * 1000) / this.interval * this.slotCount;\n      return daySlot * day + slotTd;\n    }\n  };\n\n  TimelineEvent.prototype.getPosition = function (startTime, endTime, isAllDay, day) {\n    if (this.renderType === 'day' || isAllDay) {\n      return day * this.slotsPerDay * this.cellWidth;\n    }\n\n    var currentDate = util.resetTime(new Date(this.dateRender[day].getTime()));\n    var schedule = util.getStartEndHours(currentDate, this.startHour, this.endHour);\n    var cellIndex;\n\n    if (schedule.endHour.getTime() <= endTime.getTime() && schedule.startHour.getTime() >= startTime.getTime()) {\n      cellIndex = this.getAppointmentLeft(schedule, schedule.startHour, day);\n    } else if (schedule.endHour.getTime() <= endTime.getTime()) {\n      cellIndex = this.getAppointmentLeft(schedule, startTime, day);\n    } else if (schedule.startHour.getTime() >= startTime.getTime()) {\n      cellIndex = this.getAppointmentLeft(schedule, schedule.startHour, day);\n    } else {\n      cellIndex = this.getAppointmentLeft(schedule, startTime, day);\n    }\n\n    return cellIndex * this.cellWidth;\n  }; //tslint:disable-next-line:max-line-length\n\n\n  TimelineEvent.prototype.getFilterEvents = function (startDate, endDate, startTime, endTime, gIndex, eventsList) {\n    if (this.renderType === 'day') {\n      return this.getFilteredEvents(startDate, endDate, gIndex, eventsList);\n    } else {\n      return this.getFilteredEvents(startTime, endTime, gIndex, eventsList);\n    }\n  };\n\n  TimelineEvent.prototype.isAlreadyAvail = function (appPos, cellTd) {\n    var moreIndicator = [].slice.call(cellTd.querySelectorAll('.' + cls.MORE_INDICATOR_CLASS));\n\n    for (var i = 0; i < moreIndicator.length; i++) {\n      var indicatorPos = void 0;\n\n      if (moreIndicator) {\n        indicatorPos = this.parent.enableRtl ? moreIndicator[i].style.right : moreIndicator[i].style.left;\n      }\n\n      if (parseInt(indicatorPos, 10) === Math.floor(appPos)) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  TimelineEvent.prototype.getRowTop = function (resIndex) {\n    if (this.parent.activeViewOptions.group.resources.length > 0 && !this.parent.uiStateValues.isGroupAdaptive) {\n      var td = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS + ' ' + 'tbody td[data-group-index=\"' + resIndex.toString() + '\"]');\n      return td.offsetTop;\n    }\n\n    return 0;\n  };\n\n  TimelineEvent.prototype.getCellTd = function () {\n    var wrapIndex = this.parent.uiStateValues.isGroupAdaptive ? 0 : this.rowIndex;\n    return this.appContainers[wrapIndex];\n  };\n\n  TimelineEvent.prototype.renderBlockIndicator = function (cellTd, position, resIndex) {\n    // No need to render block icon for Year, Month and Week header rows\n    if (this.parent.headerRows.length > 0 && (this.parent.headerRows[this.parent.headerRows.length - 1].option !== 'Hour' || this.parent.headerRows[this.parent.headerRows.length - 1].option !== 'Date')) {\n      return;\n    }\n\n    position = Math.floor(position / this.cellWidth) * this.cellWidth + this.cellWidth - BLOCK_INDICATOR_WIDTH;\n\n    if (!this.isAlreadyAvail(position, cellTd)) {\n      var blockIndicator = createElement('div', {\n        className: 'e-icons ' + cls.BLOCK_INDICATOR_CLASS\n      });\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        blockIndicator.setAttribute('data-group-index', resIndex.toString());\n      }\n\n      if (this.parent.enableRtl) {\n        blockIndicator.style.right = position + 'px';\n      } else {\n        blockIndicator.style.left = position + 'px';\n      }\n\n      blockIndicator.style.top = this.getRowTop(resIndex) + this.cellHeight - BLOCK_INDICATOR_HEIGHT + 'px';\n      this.renderElement(cellTd, blockIndicator);\n    }\n  };\n\n  return TimelineEvent;\n}(MonthEvent);\n\nexport { TimelineEvent };","map":{"version":3,"sources":["C:/Users/grigo/OneDrive/Рабочий стол/CRM/node_modules/@syncfusion/ej2-schedule/src/schedule/event-renderer/timeline-view.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","isNullOrUndefined","setStyleAttribute","extend","EventHandler","createElement","cls","util","MonthEvent","EVENT_GAP","BLOCK_INDICATOR_WIDTH","BLOCK_INDICATOR_HEIGHT","TimelineEvent","_super","parent","type","_this","call","startHour","activeView","getStartHour","endHour","getEndHour","slotCount","activeViewOptions","timeScale","interval","day","rowIndex","renderType","appContainers","slice","element","querySelectorAll","APPOINTMENT_CONTAINER_CLASS","dayLength","CONTENT_TABLE_CLASS","length","children","content","querySelector","getSlotDates","slots","push","renderDates","map","date","headerRows","option","cellWidth","offsetWidth","dateRender","slotsPerDay","getOverlapEvents","appointments","appointmentsList","_i","appointments_1","app","resetTime","fields","startTime","getTime","Date","endTime","_a","appointments_2","eventData","data","trimStartTime","trimEndTime","renderResourceEvents","removeHeightProperty","RESOURCE_COLUMN_TABLE_CLASS","resources","uiStateValues","isGroupAdaptive","resourceBase","lastResourceLevel","groupIndex","renderedResources","i","renderEventsHandler","workDays","renderEvents","event","resIndex","minDate","maxDate","getStartTime","getEndTime","getIndexOfDate","cellTd","getCellTd","overlapCount","getIndex","Index","appHeight","eventHeight","diffInDays","count","appWidth","getEventWidth","isAllDay","appLeft","appRight","position","getPosition","renderedEvents","top_1","getRowTop","appTop","enableRtl","height","moreIndicatorHeight","cellHeight","rowAutoHeight","appointmentElement","createAppointmentElement","applyResourceColor","groupOrder","wireAppointmentEvents","renderEventElement","firstChild","getFirstChild","updateCellHeight","moreIndicator","MORE_INDICATOR_CLASS","appPos","Math","floor","isAlreadyAvail","startDate","endDate","addDays","startDateTime","slotStartTime","setMinutes","getMinutes","slotEndTime","group","toString","filterEvents","getFilterEvents","appArea","renderedAppCount","moreIndicatorElement","getMoreIndicatorElement","setAttribute","style","top","width","left","right","renderElement","add","moreIndicatorClick","cell","offsetHeight","resourceCell","getAttribute","index","query","td","updateBlockElements","blockElement","BLOCK_APPOINTMENT_CLASS","blockElement_1","parseInt","round","blockIndicator","BLOCK_INDICATOR_CLASS","blockIndicator_1","schedule","getStartEndHours","getNextDay","isSameDay","getSameDayEventsWidth","getSpannedEventsWidth","startWidth","endWidth","start","end","spannedWidth","startDay","endDay","getAppointmentLeft","slotTd","daySlot","currentDate","cellIndex","gIndex","eventsList","getFilteredEvents","indicatorPos","CONTENT_WRAP_CLASS","offsetTop","wrapIndex","renderBlockIndicator","className"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { isNullOrUndefined, setStyleAttribute, extend, EventHandler, createElement } from '@syncfusion/ej2-base';\nimport * as cls from '../base/css-constant';\nimport * as util from '../base/util';\nimport { MonthEvent } from './month';\nvar EVENT_GAP = 2;\nvar BLOCK_INDICATOR_WIDTH = 22;\nvar BLOCK_INDICATOR_HEIGHT = 18;\n/**\n * Timeline view events render\n */\nvar TimelineEvent = /** @class */ (function (_super) {\n    __extends(TimelineEvent, _super);\n    /**\n     * Constructor for timeline views\n     */\n    function TimelineEvent(parent, type) {\n        var _this = _super.call(this, parent) || this;\n        _this.startHour = _this.parent.activeView.getStartHour();\n        _this.endHour = _this.parent.activeView.getEndHour();\n        _this.slotCount = _this.parent.activeViewOptions.timeScale.slotCount;\n        _this.interval = _this.parent.activeViewOptions.timeScale.interval;\n        _this.day = 0;\n        _this.rowIndex = 0;\n        _this.renderType = type;\n        _this.appContainers = [].slice.call(_this.element.querySelectorAll('.' + cls.APPOINTMENT_CONTAINER_CLASS));\n        _this.dayLength = _this.element.querySelectorAll('.' + cls.CONTENT_TABLE_CLASS + ' tbody tr').length === 0 ?\n            0 : _this.element.querySelectorAll('.' + cls.CONTENT_TABLE_CLASS + ' tbody tr')[0].children.length;\n        _this.content = _this.parent.element.querySelector('.' + cls.CONTENT_TABLE_CLASS);\n        return _this;\n    }\n    TimelineEvent.prototype.getSlotDates = function () {\n        this.slots = [];\n        this.slots.push(this.parent.activeView.renderDates.map(function (date) { return +date; }));\n        if (this.parent.headerRows.length > 0 &&\n            this.parent.headerRows[this.parent.headerRows.length - 1].option !== 'Hour') {\n            this.renderType = 'day';\n            this.cellWidth = this.content.offsetWidth / this.dateRender.length;\n            this.slotsPerDay = 1;\n        }\n        else {\n            this.slotsPerDay = (this.dayLength / this.dateRender.length);\n        }\n    };\n    TimelineEvent.prototype.getOverlapEvents = function (date, appointments) {\n        var appointmentsList = [];\n        if (this.renderType === 'day') {\n            for (var _i = 0, appointments_1 = appointments; _i < appointments_1.length; _i++) {\n                var app = appointments_1[_i];\n                if ((util.resetTime(app[this.fields.startTime]).getTime() <= util.resetTime(new Date(date.getTime())).getTime()) &&\n                    (util.resetTime(app[this.fields.endTime]).getTime() >= util.resetTime(new Date(date.getTime())).getTime())) {\n                    appointmentsList.push(app);\n                }\n            }\n        }\n        else {\n            for (var _a = 0, appointments_2 = appointments; _a < appointments_2.length; _a++) {\n                var app = appointments_2[_a];\n                var eventData = app.data;\n                if (eventData.trimStartTime.getTime() <= date.getTime() &&\n                    eventData.trimEndTime.getTime() > date.getTime()) {\n                    appointmentsList.push(app);\n                }\n            }\n        }\n        return appointmentsList;\n    };\n    TimelineEvent.prototype.renderResourceEvents = function () {\n        this.removeHeightProperty(cls.RESOURCE_COLUMN_TABLE_CLASS);\n        var resources = this.parent.uiStateValues.isGroupAdaptive ?\n            [this.parent.resourceBase.lastResourceLevel[this.parent.uiStateValues.groupIndex]] :\n            this.parent.resourceBase.renderedResources;\n        for (var i = 0; i < resources.length; i++) {\n            this.rowIndex = i;\n            this.renderEventsHandler(this.parent.activeView.renderDates, this.parent.activeViewOptions.workDays, resources[i]);\n        }\n    };\n    TimelineEvent.prototype.renderEvents = function (event, resIndex, appointmentsList) {\n        var startTime = event[this.fields.startTime];\n        var endTime = event[this.fields.endTime];\n        if ((startTime.getTime() < this.parent.minDate.getTime()) || (endTime.getTime() > this.parent.maxDate.getTime())) {\n            return;\n        }\n        var eventData = event.data;\n        startTime = this.getStartTime(event, eventData);\n        endTime = this.getEndTime(event, eventData);\n        this.day = this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(startTime.getTime())));\n        if (this.day < 0) {\n            return;\n        }\n        var cellTd = this.getCellTd();\n        var overlapCount = this.getIndex(startTime);\n        event.Index = overlapCount;\n        var appHeight = this.eventHeight;\n        var diffInDays = eventData.count;\n        if (startTime <= endTime) {\n            var appWidth = this.getEventWidth(startTime, endTime, event[this.fields.isAllDay], diffInDays);\n            appWidth = this.renderType === 'day' ? appWidth - 2 : appWidth;\n            var appLeft = 0;\n            var appRight = 0;\n            var position = this.getPosition(startTime, endTime, event[this.fields.isAllDay], this.day);\n            appWidth = (appWidth <= 0) ? this.cellWidth : appWidth; // appWidth 0 when start and end time as same\n            this.renderedEvents.push(extend({}, event, null, true));\n            var top_1 = this.getRowTop(resIndex);\n            var appTop = (top_1 + EVENT_GAP) + (overlapCount * (appHeight + EVENT_GAP));\n            appLeft = (this.parent.enableRtl) ? 0 : position;\n            appRight = (this.parent.enableRtl) ? position : 0;\n            var height = ((overlapCount + 1) * (appHeight + EVENT_GAP)) + this.moreIndicatorHeight;\n            if ((this.cellHeight > height) || this.parent.rowAutoHeight) {\n                var appointmentElement = this.createAppointmentElement(event, resIndex);\n                this.applyResourceColor(appointmentElement, event, 'backgroundColor', this.groupOrder);\n                setStyleAttribute(appointmentElement, {\n                    'width': appWidth + 'px', 'left': appLeft + 'px', 'right': appRight + 'px', 'top': appTop + 'px'\n                });\n                this.wireAppointmentEvents(appointmentElement, event);\n                this.renderEventElement(event, appointmentElement, cellTd);\n                if (this.parent.rowAutoHeight) {\n                    var firstChild = this.getFirstChild(resIndex);\n                    this.updateCellHeight(firstChild, height);\n                }\n            }\n            else {\n                for (var i = 0; i < diffInDays; i++) {\n                    var moreIndicator = cellTd.querySelector('.' + cls.MORE_INDICATOR_CLASS);\n                    var appPos = (this.parent.enableRtl) ? appRight : appLeft;\n                    appPos = (Math.floor(appPos / this.cellWidth) * this.cellWidth);\n                    if ((cellTd && isNullOrUndefined(moreIndicator)) ||\n                        (!this.isAlreadyAvail(appPos, cellTd))) {\n                        var interval = this.interval / this.slotCount;\n                        var startDate = new Date(this.dateRender[this.day + i].getTime());\n                        var endDate = util.addDays(this.dateRender[this.day + i], 1);\n                        var startDateTime = new Date(+startTime);\n                        var slotStartTime = (new Date(startDateTime.setMinutes(Math.floor(startDateTime.getMinutes() / interval) * interval)));\n                        var slotEndTime = new Date(slotStartTime.getTime() + (60000 * interval));\n                        var groupIndex = void 0;\n                        if (this.parent.activeViewOptions.group.resources.length > 0 && !isNullOrUndefined(resIndex)) {\n                            groupIndex = resIndex.toString();\n                        }\n                        var filterEvents = this.getFilterEvents(startDate, endDate, slotStartTime, slotEndTime, groupIndex, appointmentsList);\n                        var appArea = this.cellHeight - this.moreIndicatorHeight;\n                        var renderedAppCount = Math.floor(appArea / (appHeight + EVENT_GAP));\n                        var count = (filterEvents.length - renderedAppCount) <= 0 ? 1 : (filterEvents.length - renderedAppCount);\n                        var moreIndicatorElement = void 0;\n                        if (this.renderType === 'day') {\n                            moreIndicatorElement = this.getMoreIndicatorElement(count, startDate, endDate);\n                        }\n                        else {\n                            moreIndicatorElement = this.getMoreIndicatorElement(count, slotStartTime, slotEndTime);\n                        }\n                        if (!isNullOrUndefined(groupIndex)) {\n                            moreIndicatorElement.setAttribute('data-group-index', groupIndex);\n                        }\n                        moreIndicatorElement.style.top = top_1 + appArea + 'px';\n                        moreIndicatorElement.style.width = this.cellWidth + 'px';\n                        moreIndicatorElement.style.left = (Math.floor(appLeft / this.cellWidth) * this.cellWidth) + 'px';\n                        moreIndicatorElement.style.right = (Math.floor(appRight / this.cellWidth) * this.cellWidth) + 'px';\n                        this.renderElement(cellTd, moreIndicatorElement);\n                        EventHandler.add(moreIndicatorElement, 'click', this.moreIndicatorClick, this);\n                    }\n                }\n            }\n        }\n    };\n    TimelineEvent.prototype.updateCellHeight = function (cell, height) {\n        if ((height > cell.offsetHeight)) {\n            setStyleAttribute(cell, { 'height': height + 'px' });\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                var resourceCell = this.parent.element.querySelector('.' + cls.RESOURCE_COLUMN_TABLE_CLASS + ' ' + 'tbody td[data-group-index=\"' +\n                    cell.getAttribute('data-group-index') + '\"]');\n                setStyleAttribute(resourceCell, { 'height': height + 'px' });\n            }\n        }\n    };\n    TimelineEvent.prototype.getFirstChild = function (index) {\n        var query = '.' + cls.CONTENT_TABLE_CLASS + ' tbody td';\n        var groupIndex = '';\n        if (this.parent.activeViewOptions.group.resources.length > 0) {\n            groupIndex = '[data-group-index=\"' + index.toString() + '\"]';\n        }\n        var td = this.parent.element.querySelector(query + groupIndex);\n        return td;\n    };\n    TimelineEvent.prototype.updateBlockElements = function () {\n        var blockElement = [].slice.call(this.element.querySelectorAll('.' + cls.BLOCK_APPOINTMENT_CLASS));\n        for (var _i = 0, blockElement_1 = blockElement; _i < blockElement_1.length; _i++) {\n            var element = blockElement_1[_i];\n            var resIndex = parseInt(element.getAttribute('data-group-index'), 10);\n            var firstChild = this.getFirstChild(resIndex);\n            element.style.height = firstChild.offsetHeight + 'px';\n            var width = Math.round(element.offsetWidth / firstChild.offsetWidth);\n            element.style.width = (firstChild.offsetWidth * width) + 'px';\n        }\n        var blockIndicator = [].slice.call(this.element.querySelectorAll('.' + cls.BLOCK_INDICATOR_CLASS));\n        for (var _a = 0, blockIndicator_1 = blockIndicator; _a < blockIndicator_1.length; _a++) {\n            var element = blockIndicator_1[_a];\n            var resIndex = parseInt(element.getAttribute('data-group-index'), 10);\n            element.style.top = this.getRowTop(resIndex) +\n                this.getFirstChild(resIndex).offsetHeight - BLOCK_INDICATOR_HEIGHT + 'px';\n        }\n    };\n    TimelineEvent.prototype.getStartTime = function (event, eventData) {\n        var startTime = event[this.fields.startTime];\n        var schedule = util.getStartEndHours(startTime, this.startHour, this.endHour);\n        if (schedule.startHour.getTime() >= eventData[this.fields.startTime]) {\n            startTime = schedule.startHour;\n        }\n        else if (schedule.endHour.getTime() <= eventData[this.fields.startTime]) {\n            startTime = this.getNextDay(schedule.startHour, eventData);\n        }\n        else {\n            startTime = eventData[this.fields.startTime];\n        }\n        // To overcome the overflow\n        eventData.trimStartTime = (event[this.fields.isAllDay]) ? schedule.startHour : eventData[this.fields.startTime];\n        return startTime;\n    };\n    TimelineEvent.prototype.getNextDay = function (startTime, eventData) {\n        var startDate;\n        for (var i = 1; i <= this.dateRender.length; i++) {\n            startDate = util.addDays(startTime, i);\n            if (this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(startTime.getTime()))) !== -1) {\n                eventData.count = eventData.count - 1;\n                return startDate;\n            }\n        }\n        return startDate;\n    };\n    TimelineEvent.prototype.getEndTime = function (event, eventData) {\n        var endTime = event[this.fields.endTime];\n        var schedule = util.getStartEndHours(endTime, this.startHour, this.endHour);\n        if (schedule.endHour.getTime() <= eventData[this.fields.endTime]) {\n            endTime = schedule.endHour;\n        }\n        else {\n            endTime = eventData[this.fields.endTime];\n        }\n        // To overcome the overflow\n        eventData.trimEndTime = (event[this.fields.isAllDay]) ? schedule.endHour : eventData[this.fields.endTime];\n        return endTime;\n    };\n    TimelineEvent.prototype.getEventWidth = function (startDate, endDate, isAllDay, count) {\n        if (this.renderType === 'day' || isAllDay) {\n            return (count * this.slotsPerDay) * this.cellWidth;\n        }\n        if (this.isSameDay(startDate, endDate)) {\n            return this.getSameDayEventsWidth(startDate, endDate);\n        }\n        else {\n            return this.getSpannedEventsWidth(startDate, endDate, count);\n        }\n    };\n    TimelineEvent.prototype.getSameDayEventsWidth = function (startDate, endDate) {\n        return (((endDate.getTime() - startDate.getTime())) / (60 * 1000) * (this.cellWidth * this.slotCount) / this.interval);\n    };\n    TimelineEvent.prototype.getSpannedEventsWidth = function (startDate, endDate, diffInDays) {\n        var width = (diffInDays * this.slotsPerDay) * this.cellWidth;\n        var startWidth;\n        var endWidth;\n        var start = util.getStartEndHours(util.resetTime(new Date(startDate.getTime())), this.startHour, this.endHour);\n        startWidth = this.getSameDayEventsWidth(start.startHour, startDate);\n        if (this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(endDate.getTime()))) === -1) {\n            endWidth = 0;\n        }\n        else {\n            var end = util.getStartEndHours(util.resetTime(new Date(endDate.getTime())), this.startHour, this.endHour);\n            endWidth = this.getSameDayEventsWidth(endDate, end.endHour);\n            endWidth = ((this.slotsPerDay * this.cellWidth) === endWidth) ? 0 : endWidth;\n        }\n        var spannedWidth = startWidth + endWidth;\n        return (width > spannedWidth) ? width - spannedWidth : endWidth - startWidth;\n    };\n    TimelineEvent.prototype.isSameDay = function (startTime, endTime) {\n        var startDay = this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(startTime.getTime())));\n        var endDay = this.parent.getIndexOfDate(this.dateRender, util.resetTime(new Date(endTime.getTime())));\n        return (startDay === endDay);\n    };\n    TimelineEvent.prototype.getAppointmentLeft = function (schedule, startTime, day) {\n        var slotTd = (this.isSameDay(startTime, schedule.startHour)) ?\n            ((startTime.getTime() - schedule.startHour.getTime()) / ((60 * 1000) * this.interval)) * this.slotCount : 0;\n        if (day === 0) {\n            return slotTd;\n        }\n        else {\n            var daySlot = (((schedule.endHour.getTime() - schedule.startHour.getTime()) / (60 * 1000)) / this.interval) * this.slotCount;\n            return (daySlot * day) + slotTd;\n        }\n    };\n    TimelineEvent.prototype.getPosition = function (startTime, endTime, isAllDay, day) {\n        if (this.renderType === 'day' || isAllDay) {\n            return (day * this.slotsPerDay) * this.cellWidth;\n        }\n        var currentDate = util.resetTime(new Date(this.dateRender[day].getTime()));\n        var schedule = util.getStartEndHours(currentDate, this.startHour, this.endHour);\n        var cellIndex;\n        if (schedule.endHour.getTime() <= endTime.getTime() && schedule.startHour.getTime() >= startTime.getTime()) {\n            cellIndex = this.getAppointmentLeft(schedule, schedule.startHour, day);\n        }\n        else if (schedule.endHour.getTime() <= endTime.getTime()) {\n            cellIndex = this.getAppointmentLeft(schedule, startTime, day);\n        }\n        else if (schedule.startHour.getTime() >= startTime.getTime()) {\n            cellIndex = this.getAppointmentLeft(schedule, schedule.startHour, day);\n        }\n        else {\n            cellIndex = this.getAppointmentLeft(schedule, startTime, day);\n        }\n        return cellIndex * this.cellWidth;\n    };\n    //tslint:disable-next-line:max-line-length\n    TimelineEvent.prototype.getFilterEvents = function (startDate, endDate, startTime, endTime, gIndex, eventsList) {\n        if (this.renderType === 'day') {\n            return this.getFilteredEvents(startDate, endDate, gIndex, eventsList);\n        }\n        else {\n            return this.getFilteredEvents(startTime, endTime, gIndex, eventsList);\n        }\n    };\n    TimelineEvent.prototype.isAlreadyAvail = function (appPos, cellTd) {\n        var moreIndicator = [].slice.call(cellTd.querySelectorAll('.' + cls.MORE_INDICATOR_CLASS));\n        for (var i = 0; i < moreIndicator.length; i++) {\n            var indicatorPos = void 0;\n            if (moreIndicator) {\n                indicatorPos = (this.parent.enableRtl) ? moreIndicator[i].style.right : moreIndicator[i].style.left;\n            }\n            if (parseInt(indicatorPos, 10) === Math.floor(appPos)) {\n                return true;\n            }\n        }\n        return false;\n    };\n    TimelineEvent.prototype.getRowTop = function (resIndex) {\n        if (this.parent.activeViewOptions.group.resources.length > 0 && !this.parent.uiStateValues.isGroupAdaptive) {\n            var td = this.parent.element.querySelector('.' + cls.CONTENT_WRAP_CLASS + ' ' + 'tbody td[data-group-index=\"'\n                + resIndex.toString() + '\"]');\n            return td.offsetTop;\n        }\n        return 0;\n    };\n    TimelineEvent.prototype.getCellTd = function () {\n        var wrapIndex = this.parent.uiStateValues.isGroupAdaptive ? 0 : this.rowIndex;\n        return this.appContainers[wrapIndex];\n    };\n    TimelineEvent.prototype.renderBlockIndicator = function (cellTd, position, resIndex) {\n        // No need to render block icon for Year, Month and Week header rows\n        if (this.parent.headerRows.length > 0 &&\n            (this.parent.headerRows[this.parent.headerRows.length - 1].option !== 'Hour' ||\n                this.parent.headerRows[this.parent.headerRows.length - 1].option !== 'Date')) {\n            return;\n        }\n        position = (Math.floor(position / this.cellWidth) * this.cellWidth) + this.cellWidth - BLOCK_INDICATOR_WIDTH;\n        if (!this.isAlreadyAvail(position, cellTd)) {\n            var blockIndicator = createElement('div', { className: 'e-icons ' + cls.BLOCK_INDICATOR_CLASS });\n            if (this.parent.activeViewOptions.group.resources.length > 0) {\n                blockIndicator.setAttribute('data-group-index', resIndex.toString());\n            }\n            if (this.parent.enableRtl) {\n                blockIndicator.style.right = position + 'px';\n            }\n            else {\n                blockIndicator.style.left = position + 'px';\n            }\n            blockIndicator.style.top = this.getRowTop(resIndex) + this.cellHeight - BLOCK_INDICATOR_HEIGHT + 'px';\n            this.renderElement(cellTd, blockIndicator);\n        }\n    };\n    return TimelineEvent;\n}(MonthEvent));\nexport { TimelineEvent };\n"]},"metadata":{},"sourceType":"module"}