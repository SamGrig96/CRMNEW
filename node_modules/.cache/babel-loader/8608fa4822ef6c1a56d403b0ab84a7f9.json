{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\grigo\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\CRM\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{PureComponent}from\"react\";import PerfectScrollbar from\"react-perfect-scrollbar\";import MessageRow from\"./message-row/MessageRow\";import{FontAwesomeIcon}from\"@fortawesome/react-fontawesome\";import{faSpinner}from\"@fortawesome/free-solid-svg-icons\";import ListToolbar from\"./list-toolbar/ListToolbar\";import ListFooter from\"./list-footer/ListFooter\";import\"./messageList.scss\";var ViewMode={LIST:1,CONTENT:2,EDIT:3};export var MessageList=/*#__PURE__*/function(_PureComponent){_inherits(MessageList,_PureComponent);var _super=_createSuper(MessageList);function MessageList(props){var _this;_classCallCheck(this,MessageList);_this=_super.call(this,props);_this.state={viewMode:ViewMode.LIST,contentMessageId:undefined,currentLabel:\"\"};_this.onSelectionChange=_this.onSelectionChange.bind(_assertThisInitialized(_this));_this.renderView=_this.renderView.bind(_assertThisInitialized(_this));_this.renderMessages=_this.renderMessages.bind(_assertThisInitialized(_this));return _this;}_createClass(MessageList,[{key:\"componentDidMount\",value:function componentDidMount(){var searchParam=this.props.location.search;var token=searchParam.indexOf(\"?\")===0?searchParam.slice(1):null;if(token&&this.props.messagesResult.pageTokens.length===0){this.props.addInitialPageToken(token);}var labelIds=this.props.searchQuery===\"\"?[this.props.parentLabel.id]:undefined;this.props.getLabelMessages(_objectSpread(_objectSpread({},labelIds&&{labelIds:labelIds}),{},{pageToken:token}));}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState){if(prevProps.location.search!==this.props.location.search){var searchParam=this.props.location.search;var token=searchParam.indexOf(\"?\")===0?searchParam.slice(1):null;var labelIds=this.props.searchQuery===\"\"?[this.props.parentLabel.id]:undefined;this.props.getLabelMessages(_objectSpread(_objectSpread({},labelIds&&{labelIds:labelIds}),{},{pageToken:token}));}}},{key:\"onSelectionChange\",value:function onSelectionChange(selected,msgId){this.props.toggleSelected([msgId],selected);}},{key:\"renderSpinner\",value:function renderSpinner(){return/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex h-100 justify-content-center align-items-center  \"},/*#__PURE__*/React.createElement(FontAwesomeIcon,{icon:faSpinner,spin:true,size:\"5x\"}));}},{key:\"renderMessages\",value:function renderMessages(){var _this2=this;if(this.props.messagesResult.loading){return this.renderSpinner();}else if(this.props.messagesResult.messages.length===0){return/*#__PURE__*/React.createElement(\"div\",{className:\"p-4 text-center\"},\"There are no messages with this label.\");}return this.props.messagesResult.messages.map(function(el){return/*#__PURE__*/React.createElement(MessageRow,{data:el,key:el.id,onSelectionChange:_this2.onSelectionChange,onClick:_this2.getMessage});});}},{key:\"renderView\",value:function renderView(){var viewMode=this.state.viewMode;switch(viewMode){case ViewMode.EDIT:return this.renderEditView();default:return this.renderMessages();}}},{key:\"getPageTokens\",value:function getPageTokens(){if(this.props.messagesResult.loading){return{nextToken:null,prevToken:null};}var _this$props=this.props,messagesResult=_this$props.messagesResult,location=_this$props.location;var pathname=location.pathname;var prevToken;var nextToken=messagesResult.nextPageToken;var searchParam=location.search;var currentToken=searchParam.indexOf(\"?\")===0?searchParam.slice(1):null;if(currentToken){var tokenIndex=messagesResult.pageTokens.indexOf(currentToken);if(tokenIndex>-1){nextToken=messagesResult.pageTokens[tokenIndex+1];prevToken=messagesResult.pageTokens[tokenIndex-1];if(!prevToken){if(tokenIndex>0){}}prevToken=prevToken?\"\".concat(pathname,\"?\").concat(prevToken):pathname;}else{prevToken=pathname;}}nextToken=nextToken?\"\".concat(pathname,\"?\").concat(nextToken):null;return{nextToken:nextToken,prevToken:prevToken};}},{key:\"render\",value:function render(){var messagesResult=this.props.messagesResult;var messagesTotal=messagesResult.label?messagesResult.label.result.messagesTotal:0;var _this$getPageTokens=this.getPageTokens(),nextToken=_this$getPageTokens.nextToken,prevToken=_this$getPageTokens.prevToken;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ListToolbar,{nextToken:nextToken,prevToken:prevToken,navigateToNextPage:this.props.navigateToNextPage,navigateToPrevPage:this.props.navigateToPrevPage}),/*#__PURE__*/React.createElement(PerfectScrollbar,{className:\"container-fluid no-gutters px-0 message-list-container\"},this.renderView()),/*#__PURE__*/React.createElement(ListFooter,{messagesTotal:messagesTotal}));}}]);return MessageList;}(PureComponent);export default MessageList;","map":{"version":3,"sources":["C:/Users/grigo/OneDrive/Рабочий стол/CRM/src/components/content/message-list/MessageList.jsx"],"names":["React","PureComponent","PerfectScrollbar","MessageRow","FontAwesomeIcon","faSpinner","ListToolbar","ListFooter","ViewMode","LIST","CONTENT","EDIT","MessageList","props","state","viewMode","contentMessageId","undefined","currentLabel","onSelectionChange","bind","renderView","renderMessages","searchParam","location","search","token","indexOf","slice","messagesResult","pageTokens","length","addInitialPageToken","labelIds","searchQuery","parentLabel","id","getLabelMessages","pageToken","prevProps","prevState","selected","msgId","toggleSelected","loading","renderSpinner","messages","map","el","getMessage","renderEditView","nextToken","prevToken","pathname","nextPageToken","currentToken","tokenIndex","messagesTotal","label","result","getPageTokens","navigateToNextPage","navigateToPrevPage"],"mappings":"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","sourcesContent":["import React, { PureComponent } from \"react\";\r\nimport PerfectScrollbar from \"react-perfect-scrollbar\";\r\nimport MessageRow from \"./message-row/MessageRow\";\r\n\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faSpinner } from \"@fortawesome/free-solid-svg-icons\";\r\n\r\nimport ListToolbar from \"./list-toolbar/ListToolbar\";\r\nimport ListFooter from \"./list-footer/ListFooter\";\r\n\r\nimport \"./messageList.scss\";\r\n\r\nconst ViewMode = {\r\n  LIST: 1,\r\n  CONTENT: 2,\r\n  EDIT: 3\r\n};\r\n\r\nexport class MessageList extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      viewMode: ViewMode.LIST,\r\n      contentMessageId: undefined,\r\n      currentLabel: \"\"\r\n    };\r\n\r\n    this.onSelectionChange = this.onSelectionChange.bind(this);\r\n    this.renderView = this.renderView.bind(this);\r\n    this.renderMessages = this.renderMessages.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const searchParam = this.props.location.search;\r\n    const token = searchParam.indexOf(\"?\") === 0 ? searchParam.slice(1) : null;\r\n\r\n    if (token && this.props.messagesResult.pageTokens.length === 0) {\r\n      this.props.addInitialPageToken(token);\r\n    }\r\n\r\n    const labelIds = this.props.searchQuery === \"\" ? [this.props.parentLabel.id] : undefined;\r\n\r\n    this.props.getLabelMessages({\r\n      ...labelIds && {labelIds},\r\n      pageToken: token\r\n    });\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevProps.location.search !== this.props.location.search) {\r\n      const searchParam = this.props.location.search;\r\n      const token = searchParam.indexOf(\"?\") === 0 ? searchParam.slice(1) : null;\r\n\r\n      const labelIds = this.props.searchQuery === \"\" ? [this.props.parentLabel.id] : undefined;\r\n\r\n      this.props.getLabelMessages({\r\n        ...labelIds && {labelIds},\r\n        pageToken: token\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n  onSelectionChange(selected, msgId) {\r\n    this.props.toggleSelected([msgId], selected);\r\n  }\r\n  \r\n\r\n  renderSpinner() {\r\n    return (\r\n      <div className=\"d-flex h-100 justify-content-center align-items-center  \">\r\n        <FontAwesomeIcon icon={faSpinner} spin size=\"5x\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderMessages() {\r\n    if (this.props.messagesResult.loading) {\r\n      return this.renderSpinner();\r\n    } else if (this.props.messagesResult.messages.length === 0) {\r\n      return (\r\n        <div className=\"p-4 text-center\">\r\n          There are no messages with this label.\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.messagesResult.messages.map(el => {\r\n      return (\r\n        <MessageRow\r\n          data={el}\r\n          key={el.id}\r\n          onSelectionChange={this.onSelectionChange}\r\n          onClick={this.getMessage}\r\n        />\r\n      );\r\n    });\r\n  }\r\n\r\n\r\n  renderView() {\r\n    const { viewMode } = this.state;\r\n\r\n    switch (viewMode) {\r\n\r\n      case ViewMode.EDIT:\r\n        return this.renderEditView();\r\n\r\n      default:\r\n        return this.renderMessages();\r\n    }\r\n  }\r\n\r\n  getPageTokens() {\r\n    if (this.props.messagesResult.loading) {\r\n      return { nextToken: null, prevToken: null }\r\n    }\r\n    const { messagesResult, location } = this.props;\r\n    const pathname = location.pathname;\r\n    let prevToken;\r\n    let nextToken = messagesResult.nextPageToken;\r\n    const searchParam = location.search;\r\n    const currentToken = searchParam.indexOf(\"?\") === 0 ? searchParam.slice(1) : null;\r\n    if (currentToken) {\r\n      const tokenIndex = messagesResult.pageTokens.indexOf(currentToken);\r\n      if (tokenIndex > -1) {\r\n        nextToken = messagesResult.pageTokens[tokenIndex + 1];\r\n        prevToken = messagesResult.pageTokens[tokenIndex - 1];\r\n        if (!prevToken) {\r\n          if (tokenIndex > 0) {\r\n          }\r\n        }\r\n        prevToken = prevToken ? `${pathname}?${prevToken}` : pathname;\r\n      }\r\n      else {\r\n        prevToken = pathname;\r\n      }\r\n    }\r\n    nextToken = nextToken ? `${pathname}?${nextToken}` : null;\r\n    return { nextToken, prevToken };\r\n  }\r\n\r\n  render() {\r\n    const { messagesResult } = this.props;\r\n    const messagesTotal = messagesResult.label ? messagesResult.label.result.messagesTotal : 0;\r\n    const { nextToken, prevToken } = this.getPageTokens();    \r\n    return (\r\n      <React.Fragment>\r\n        <ListToolbar\r\n          nextToken={nextToken}\r\n          prevToken={prevToken}\r\n          navigateToNextPage={this.props.navigateToNextPage}\r\n          navigateToPrevPage={this.props.navigateToPrevPage}\r\n        />\r\n        <PerfectScrollbar className=\"container-fluid no-gutters px-0 message-list-container\">\r\n          {this.renderView()}\r\n        </PerfectScrollbar>\r\n        <ListFooter messagesTotal={messagesTotal} />\r\n      </React.Fragment>\r\n    );\r\n  }  \r\n}\r\n\r\nexport default MessageList;\r\n"]},"metadata":{},"sourceType":"module"}